# 环境变量配置说明

## 概述

本项目使用环境变量来管理各种配置参数，特别是腾讯云实时语音识别服务的相关配置。

## 配置文件

- `.env.development` - 开发环境配置
- `.env.production` - 生产环境配置

## 腾讯云实时语音识别配置

### 必需配置项

这些配置项必须填写，否则语音识别功能无法正常工作：

```bash
# 腾讯云访问密钥 ID
TENCENT_SECRET_ID=your_secret_id_here

# 腾讯云访问密钥 Key
TENCENT_SECRET_KEY=your_secret_key_here

# 腾讯云应用 ID
TENCENT_APP_ID=your_app_id_here
```

### 可选配置项

这些配置项有默认值，可以根据需要调整：

```bash
# 语音识别引擎模型类型（默认：16k_zh）
# 可选值：16k_zh, 16k_zh_video, 16k_en, 16k_ca, 16k_ja, 16k_wuu-SH
TENCENT_ASR_ENGINE_MODEL_TYPE=16k_zh

# 语音格式（默认：1）
# 1: pcm, 4: speex, 6: silk, 8: mp3, 12: opus, 14: wav, 16: m4a
TENCENT_ASR_VOICE_FORMAT=1

# 热词 ID（可选）
TENCENT_ASR_HOTWORD_ID=

# 自学习模型 ID（可选）
TENCENT_ASR_CUSTOMIZATION_ID=

# 脏词过滤（默认：1）
# 0: 不过滤脏词, 1: 过滤脏词, 2: 将脏词替换为 *
TENCENT_ASR_FILTER_DIRTY=1

# 语气词过滤（默认：2）
# 0: 不过滤语气词, 1: 部分过滤, 2: 严格过滤
TENCENT_ASR_FILTER_MODAL=2

# 标点符号过滤（默认：0）
# 0: 不过滤标点, 1: 过滤句末标点, 2: 过滤所有标点
TENCENT_ASR_FILTER_PUNC=0

# 数字转换模式（默认：1）
# 0: 直接输出中文数字, 1: 根据场景智能转换为阿拉伯数字
TENCENT_ASR_CONVERT_NUM_MODE=1

# 词级别时间戳（默认：0）
# 0: 不显示词级别时间戳, 1: 显示词级别时间戳
TENCENT_ASR_WORD_INFO=0

# 静音检测时间（默认：1000ms）
# 单位：毫秒，范围：500-5000
TENCENT_ASR_VAD_SILENCE_TIME=1000

# 噪声阈值（默认：0.6）
# 范围：0.0-1.0，值越小越敏感
TENCENT_ASR_NOISE_THRESHOLD=0.6

# 最大说话时间（默认：60000ms）
# 单位：毫秒，范围：1000-90000
TENCENT_ASR_MAX_SPEAK_TIME=60000
```

## 如何获取腾讯云配置

### 1. 注册腾讯云账号

访问 [腾讯云官网](https://cloud.tencent.com/) 注册账号。

### 2. 开通实时语音识别服务

1. 登录腾讯云控制台
2. 搜索"语音识别"服务
3. 开通"实时语音识别"服务

### 3. 获取访问密钥

1. 进入 [访问管理控制台](https://console.cloud.tencent.com/cam/capi)
2. 点击"新建密钥"
3. 记录生成的 `SecretId` 和 `SecretKey`

### 4. 获取应用 ID

1. 进入 [账号信息页面](https://console.cloud.tencent.com/developer)
2. 查看"基本信息"中的"APPID"

## 配置步骤

1. 复制环境变量模板：

   ```bash
   cp .env.development.example .env.development
   cp .env.production.example .env.production
   ```

2. 编辑配置文件，填入您的腾讯云配置：

   ```bash
   # 编辑开发环境配置
   nano .env.development

   # 编辑生产环境配置
   nano .env.production
   ```

3. 将 `your_secret_id_here`、`your_secret_key_here`、`your_app_id_here` 替换为您的实际配置。

## 安全注意事项

⚠️ **重要提醒**：

1. **不要将包含真实密钥的 `.env` 文件提交到版本控制系统**
2. **确保 `.env` 文件已添加到 `.gitignore`**
3. **定期轮换访问密钥**
4. **使用最小权限原则配置 API 密钥**

## 配置验证

应用启动时会自动验证环境变量配置。如果配置不完整或格式错误，会在控制台显示详细的错误信息。

您也可以使用以下代码手动验证配置：

```typescript
import { validateEnvConfig } from '@shared/config/env-config';

const validation = validateEnvConfig();
if (!validation.isValid) {
  console.error('环境变量配置错误：', validation.errors);
} else {
  console.log('环境变量配置验证通过');
}
```

## 故障排除

### 常见问题

1. **"腾讯云实时语音识别配置不完整"错误**
   - 检查 `TENCENT_SECRET_ID`、`TENCENT_SECRET_KEY`、`TENCENT_APP_ID` 是否正确填写

2. **"环境变量必须是数字"错误**
   - 检查数值类型的配置项是否填写了非数字值

3. **语音识别连接失败**
   - 检查网络连接
   - 验证腾讯云账号是否已开通实时语音识别服务
   - 确认访问密钥是否有效

### 调试模式

在开发环境中，可以设置 `LOG_LEVEL=debug` 来获取更详细的日志信息。
