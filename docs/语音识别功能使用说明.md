# 语音识别功能使用说明

## 功能概述

本项目集成了腾讯云实时语音识别功能，支持实时语音转文字，特别针对程序员面试场景进行了优化，包含大量编程相关的专业词汇。

## 主要特性

### 1. 实时语音识别

- 基于腾讯云实时语音识别API
- 支持16kHz中文普通话识别
- 实时返回识别结果，包含临时结果和最终结果

### 2. 程序员专业词汇优化

- 内置100+编程语言、框架、工具等专业词汇
- 支持JavaScript、Python、Java、React、Vue等技术词汇
- 动态热词权重调整，提高识别准确率

### 3. 智能语音处理

- 自动静音检测(VAD)
- 噪声抑制和回声消除
- 音量可视化显示

### 4. 用户友好界面

- 实时波形显示
- 状态指示器
- 识别结果历史记录
- 详细的识别信息展示

## 配置说明

### 环境变量配置

在 `.env.development` 文件中配置以下参数：

```env
# 腾讯云实时语音识别配置
TENCENT_SECRET_ID=your_tencent_secret_id_here
TENCENT_SECRET_KEY=your_tencent_secret_key_here
TENCENT_APP_ID=your_tencent_app_id_here
TENCENT_CLOUD_ASR_URL=wss://asr.tencentcloudapi.com
TENCENT_ASR_ENGINE_MODEL_TYPE=16k_zh
TENCENT_ASR_VOICE_FORMAT=1
TENCENT_ASR_FILTER_DIRTY=1
TENCENT_ASR_FILTER_MODAL=2
TENCENT_ASR_FILTER_PUNC=0
TENCENT_ASR_CONVERT_NUM_MODE=1
TENCENT_ASR_WORD_INFO=2
TENCENT_ASR_VAD_SILENCE_TIME=1000
TENCENT_ASR_NOISE_THRESHOLD=0.6
TENCENT_ASR_MAX_SPEAK_TIME=60000
```

### 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `TENCENT_SECRET_ID` | 腾讯云API密钥ID | 必填 |
| `TENCENT_SECRET_KEY` | 腾讯云API密钥Key | 必填 |
| `TENCENT_APP_ID` | 腾讯云应用ID | 必填 |
| `TENCENT_ASR_ENGINE_MODEL_TYPE` | 引擎模型类型 | `16k_zh` |
| `TENCENT_ASR_VOICE_FORMAT` | 音频格式 | `1` (PCM) |
| `TENCENT_ASR_FILTER_DIRTY` | 过滤脏词 | `1` (开启) |
| `TENCENT_ASR_FILTER_MODAL` | 过滤语气词 | `2` (严格过滤) |
| `TENCENT_ASR_FILTER_PUNC` | 过滤标点符号 | `0` (不过滤) |
| `TENCENT_ASR_CONVERT_NUM_MODE` | 数字转换模式 | `1` (开启) |
| `TENCENT_ASR_WORD_INFO` | 词级别时间戳 | `2` (返回详细信息) |

## 使用方法

### 1. 启动应用

```bash
npm run dev
```

### 2. 访问语音测试页面

- 登录应用后，点击导航栏中的"🎤 语音测试"按钮
- 或者在主界面点击"语音测试"按钮

### 3. 开始语音识别

1. **初始化服务**：页面加载时会自动初始化语音识别服务
2. **开始录音**：点击"开始录音"按钮开始语音识别
3. **实时识别**：说话时会实时显示识别结果
4. **停止录音**：点击"停止录音"按钮结束识别

### 4. 查看结果

- **实时结果**：在录音过程中显示临时识别结果
- **最终结果**：录音结束后显示最终识别结果
- **历史记录**：查看所有转录历史
- **详细信息**：包含置信度、时间戳、词级别信息等

## API接口

### 语音服务API

```typescript
// 初始化语音服务
await voiceAPIService.initialize();

// 开始录音和识别
await voiceAPIService.startRecordingAndRecognition();

// 停止录音和识别
await voiceAPIService.stopRecordingAndRecognition();

// 获取服务状态
const status = await voiceAPIService.getStatus();
```

### 事件监听

```typescript
// 监听识别结果
voiceAPIService.on('recognitionResult', (result) => {
  console.log('识别结果:', result.text);
});

// 监听最终结果
voiceAPIService.on('finalResult', (result) => {
  console.log('最终结果:', result.text);
});

// 监听错误
voiceAPIService.on('asrError', (error) => {
  console.error('识别错误:', error);
});
```

## 热词配置

### 内置热词分类

1. **编程语言**：JavaScript, TypeScript, Python, Java, C++, Go, Rust等
2. **前端框架**：React, Vue, Angular, Next.js, Nuxt.js等
3. **后端框架**：Spring Boot, Express, Django, Flask等
4. **数据库**：MySQL, PostgreSQL, MongoDB, Redis等
5. **云服务**：AWS, Azure, 阿里云, 腾讯云, Docker, Kubernetes等
6. **开发工具**：Git, GitHub, VS Code, WebStorm等
7. **技术概念**：API, RESTful, GraphQL, 微服务, 容器化等

### 自定义热词

可以通过修改 `src/shared/constants/programmer-hotwords.ts` 文件来添加自定义热词：

```typescript
export const CUSTOM_HOT_WORDS = [
  { word: '自定义词汇', weight: 10 },
  { word: '特殊术语', weight: 8 }
];
```

## 故障排除

### 常见问题

1. **无法连接到ASR服务**
   - 检查网络连接
   - 验证腾讯云API密钥配置
   - 确认应用ID正确

2. **识别准确率低**
   - 检查麦克风设置
   - 确保环境安静
   - 调整噪声阈值参数

3. **音频权限问题**
   - 确保浏览器已授权麦克风权限
   - 检查系统音频设备设置

### 调试方法

1. **查看控制台日志**

   ```bash
   # 开启详细日志
   LOG_LEVEL=debug npm run dev
   ```

2. **检查服务状态**

   ```typescript
   const status = await voiceAPIService.getStatus();
   console.log('服务状态:', status);
   ```

3. **测试网络连接**

   ```bash
   # 测试WebSocket连接
   wscat -c wss://asr.tencentcloudapi.com/asr/v2/your_app_id
   ```

## 性能优化

### 音频处理优化

1. **采样率设置**：使用16kHz采样率以平衡质量和性能
2. **缓冲区大小**：调整音频缓冲区大小以减少延迟
3. **压缩算法**：使用适当的音频压缩以减少带宽使用

### 网络优化

1. **连接复用**：保持WebSocket连接以减少连接开销
2. **重连机制**：实现自动重连以提高稳定性
3. **错误处理**：完善的错误处理和恢复机制

## 安全考虑

1. **API密钥保护**：确保API密钥不被泄露
2. **数据传输**：使用HTTPS/WSS加密传输
3. **权限控制**：合理设置麦克风权限
4. **数据存储**：避免在本地存储敏感音频数据

## 更新日志

### v1.0.0 (2024-01-XX)

- 初始版本发布
- 集成腾讯云实时语音识别
- 支持程序员专业词汇识别
- 实现语音测试界面
- 添加实时波形显示
- 支持识别结果历史记录

## 技术支持

如有问题或建议，请通过以下方式联系：

- 项目Issues：[GitHub Issues](https://github.com/your-repo/issues)
- 技术文档：查看 `docs/` 目录下的相关文档
- 腾讯云文档：[实时语音识别API文档](https://cloud.tencent.com/document/product/1093)

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。
