# AI面试助手桌面端项目结构设计

## 1. 整体项目结构

```text
offerHelper/
├── README.md                          # 项目说明文档
├── package.json                       # 项目依赖配置
├── package-lock.json                  # 依赖锁定文件
├── tsconfig.json                      # TypeScript配置
├── webpack.config.js                  # Webpack配置
├── electron-builder.json              # 打包配置
├── .gitignore                         # Git忽略文件
├── .eslintrc.js                       # ESLint配置
├── .prettierrc                        # Prettier配置
├── .husky/                            # Git hooks配置
│   ├── pre-commit
│   └── pre-push
├── docs/                              # 项目文档
│   ├── 技术架构设计.md
│   ├── 功能交互设计.md
│   ├── 视觉UI原型.md
│   ├── 项目结构设计.md
│   ├── 开发规范.md
│   └── API文档.md
├── src/                               # 源代码目录
│   ├── main/                          # 主进程代码
│   │   ├── index.ts                   # 主进程入口
│   │   ├── window/                    # 窗口管理
│   │   │   ├── MainWindow.ts          # 主窗口类
│   │   │   ├── LoginWindow.ts         # 登录窗口类
│   │   │   ├── SettingsWindow.ts      # 设置窗口类
│   │   │   └── WindowManager.ts       # 窗口管理器
│   │   ├── services/                  # 主进程服务
│   │   │   ├── ScreenShareDetector.ts # 屏幕共享检测
│   │   │   ├── ShortcutManager.ts     # 快捷键管理
│   │   │   ├── TrayManager.ts         # 系统托盘管理
│   │   │   ├── UpdateManager.ts       # 自动更新管理
│   │   │   └── PermissionManager.ts   # 权限管理
│   │   ├── ipc/                       # IPC通信
│   │   │   ├── handlers/              # IPC处理器
│   │   │   │   ├── window.ts          # 窗口相关IPC
│   │   │   │   ├── system.ts          # 系统相关IPC
│   │   │   │   ├── audio.ts           # 音频相关IPC
│   │   │   │   └── settings.ts        # 设置相关IPC
│   │   │   └── channels.ts            # IPC通道定义
│   │   ├── utils/                     # 主进程工具
│   │   │   ├── logger.ts              # 日志工具
│   │   │   ├── config.ts              # 配置管理
│   │   │   └── security.ts            # 安全工具
│   │   └── preload/                   # 预加载脚本
│   │       ├── index.ts               # 主预加载脚本
│   │       └── types.ts               # 预加载类型定义
│   ├── renderer/                      # 渲染进程代码
│   │   ├── index.tsx                  # 渲染进程入口
│   │   ├── App.tsx                    # 根组件
│   │   ├── components/                # React组件
│   │   │   ├── common/                # 通用组件
│   │   │   │   ├── Button/            # 按钮组件
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── Button.styled.ts
│   │   │   │   │   └── Button.types.ts
│   │   │   │   ├── Input/             # 输入框组件
│   │   │   │   ├── Modal/             # 模态框组件
│   │   │   │   ├── Slider/            # 滑块组件
│   │   │   │   ├── Switch/            # 开关组件
│   │   │   │   └── Loading/           # 加载组件
│   │   │   ├── layout/                # 布局组件
│   │   │   │   ├── TitleBar/          # 标题栏
│   │   │   │   ├── StatusBar/         # 状态栏
│   │   │   │   ├── ControlBar/        # 控制栏
│   │   │   │   └── Sidebar/           # 侧边栏
│   │   │   ├── voice/                 # 语音相关组件
│   │   │   │   ├── VoiceRecorder/     # 语音录制器
│   │   │   │   ├── VolumeIndicator/   # 音量指示器
│   │   │   │   ├── RecognitionText/   # 识别文本显示
│   │   │   │   └── AIResponse/        # AI回答显示
│   │   │   ├── settings/              # 设置相关组件
│   │   │   │   ├── BasicSettings/     # 基础设置
│   │   │   │   ├── AudioSettings/     # 音频设置
│   │   │   │   ├── ShortcutSettings/  # 快捷键设置
│   │   │   │   └── AboutSettings/     # 关于设置
│   │   │   └── auth/                  # 认证相关组件
│   │   │       ├── LoginForm/         # 登录表单
│   │   │       ├── VerificationCode/  # 验证码输入
│   │   │       └── UserProfile/       # 用户资料
│   │   ├── pages/                     # 页面组件
│   │   │   ├── MainPage/              # 主页面
│   │   │   ├── LoginPage/             # 登录页面
│   │   │   ├── SettingsPage/          # 设置页面
│   │   │   └── OnboardingPage/        # 引导页面
│   │   ├── hooks/                     # 自定义Hooks
│   │   │   ├── useVoiceRecognition.ts # 语音识别Hook
│   │   │   ├── useScreenShare.ts      # 屏幕共享Hook
│   │   │   ├── useShortcuts.ts        # 快捷键Hook
│   │   │   ├── useSettings.ts         # 设置Hook
│   │   │   ├── useAuth.ts             # 认证Hook
│   │   │   └── useIPC.ts              # IPC通信Hook
│   │   ├── store/                     # Redux状态管理
│   │   │   ├── index.ts               # Store配置
│   │   │   ├── slices/                # Redux切片
│   │   │   │   ├── authSlice.ts       # 认证状态
│   │   │   │   ├── appSlice.ts        # 应用状态
│   │   │   │   ├── voiceSlice.ts      # 语音状态
│   │   │   │   └── settingsSlice.ts   # 设置状态
│   │   │   ├── api/                   # RTK Query API
│   │   │   │   ├── authApi.ts         # 认证API
│   │   │   │   ├── aiApi.ts           # AI服务API
│   │   │   │   └── userApi.ts         # 用户API
│   │   │   └── middleware/            # 中间件
│   │   │       ├── logger.ts          # 日志中间件
│   │   │       └── persist.ts         # 持久化中间件
│   │   ├── services/                  # 渲染进程服务
│   │   │   ├── VoiceService.ts        # 语音服务
│   │   │   ├── AIService.ts           # AI服务
│   │   │   ├── AuthService.ts         # 认证服务
│   │   │   ├── SettingsService.ts     # 设置服务
│   │   │   └── StorageService.ts      # 存储服务
│   │   ├── utils/                     # 渲染进程工具
│   │   │   ├── constants.ts           # 常量定义
│   │   │   ├── helpers.ts             # 辅助函数
│   │   │   ├── validators.ts          # 验证工具
│   │   │   ├── formatters.ts          # 格式化工具
│   │   │   └── encryption.ts          # 加密工具
│   │   ├── styles/                    # 样式文件
│   │   │   ├── globals.css            # 全局样式
│   │   │   ├── variables.css          # CSS变量
│   │   │   ├── themes/                # 主题样式
│   │   │   │   ├── dark.css           # 深色主题
│   │   │   │   ├── light.css          # 浅色主题
│   │   │   │   └── auto.css           # 自动主题
│   │   │   └── components/            # 组件样式
│   │   │       ├── button.css
│   │   │       ├── input.css
│   │   │       └── modal.css
│   │   └── types/                     # 类型定义
│   │       ├── global.d.ts            # 全局类型
│   │       ├── api.ts                 # API类型
│   │       ├── voice.ts               # 语音相关类型
│   │       ├── settings.ts            # 设置相关类型
│   │       └── electron.d.ts          # Electron类型扩展
│   └── shared/                        # 共享代码
│       ├── types/                     # 共享类型定义
│       │   ├── ipc.ts                 # IPC类型
│       │   ├── config.ts              # 配置类型
│       │   └── events.ts              # 事件类型
│       ├── constants/                 # 共享常量
│       │   ├── channels.ts            # IPC通道常量
│       │   ├── shortcuts.ts           # 快捷键常量
│       │   └── config.ts              # 配置常量
│       └── utils/                     # 共享工具
│           ├── logger.ts              # 日志工具
│           ├── validation.ts          # 验证工具
│           └── crypto.ts              # 加密工具
├── assets/                            # 静态资源
│   ├── icons/                         # 图标文件
│   │   ├── app-icon.png               # 应用图标
│   │   ├── tray-icon.png              # 托盘图标
│   │   ├── tray-icon-active.png       # 活动状态托盘图标
│   │   └── window-icons/              # 窗口图标
│   ├── images/                        # 图片资源
│   │   ├── logo.png                   # Logo
│   │   ├── background.png             # 背景图
│   │   └── onboarding/                # 引导页图片
│   ├── sounds/                        # 音频文件
│   │   ├── notification.wav           # 通知音效
│   │   ├── start.wav                  # 开始音效
│   │   └── stop.wav                   # 停止音效
│   └── fonts/                         # 字体文件
│       └── custom-font.woff2          # 自定义字体
├── build/                             # 构建输出目录
│   ├── main/                          # 主进程构建输出
│   ├── renderer/                      # 渲染进程构建输出
│   └── preload/                       # 预加载脚本构建输出
├── dist/                              # 打包输出目录
│   ├── win/                           # Windows打包
│   ├── mac/                           # macOS打包
│   └── linux/                         # Linux打包
├── test/                              # 测试文件
│   ├── unit/                          # 单元测试
│   │   ├── main/                      # 主进程测试
│   │   └── renderer/                  # 渲染进程测试
│   ├── integration/                   # 集成测试
│   ├── e2e/                           # 端到端测试
│   └── fixtures/                      # 测试数据
├── scripts/                           # 构建脚本
│   ├── build.js                       # 构建脚本
│   ├── dev.js                         # 开发脚本
│   ├── test.js                        # 测试脚本
│   └── release.js                     # 发布脚本
└── logs/                              # 日志文件目录
    ├── main.log                       # 主进程日志
    ├── renderer.log                   # 渲染进程日志
    └── error.log                      # 错误日志
```

## 2. 核心目录详细说明

### 2.1 主进程目录 (src/main/)

主进程负责应用的生命周期管理、窗口创建、系统级API调用等核心功能。

```typescript
// src/main/index.ts - 主进程入口文件结构
import { app, BrowserWindow } from 'electron';
import { WindowManager } from './window/WindowManager';
import { TrayManager } from './services/TrayManager';
import { ShortcutManager } from './services/ShortcutManager';
import { ScreenShareDetector } from './services/ScreenShareDetector';
import { setupIPC } from './ipc/handlers';

class Application {
  private windowManager: WindowManager;
  private trayManager: TrayManager;
  private shortcutManager: ShortcutManager;
  private screenShareDetector: ScreenShareDetector;

  async initialize() {
    // 初始化各个管理器
    this.windowManager = new WindowManager();
    this.trayManager = new TrayManager();
    this.shortcutManager = new ShortcutManager();
    this.screenShareDetector = new ScreenShareDetector();

    // 设置IPC通信
    setupIPC();

    // 创建主窗口
    await this.windowManager.createMainWindow();
  }
}
```

### 2.2 渲染进程目录 (src/renderer/)

渲染进程负责UI渲染、用户交互、业务逻辑处理等前端功能。

```typescript
// src/renderer/App.tsx - 根组件结构
import React from 'react';
import { Provider } from 'react-redux';
import { BrowserRouter } from 'react-router-dom';
import { store } from './store';
import { ThemeProvider } from './contexts/ThemeContext';
import { MainPage } from './pages/MainPage';

export const App: React.FC = () => {
  return (
    <Provider store={store}>
      <BrowserRouter>
        <ThemeProvider>
          <MainPage />
        </ThemeProvider>
      </BrowserRouter>
    </Provider>
  );
};
```

### 2.3 共享代码目录 (src/shared/)

存放主进程和渲染进程共享的类型定义、常量、工具函数等。

```typescript
// src/shared/types/ipc.ts - IPC类型定义示例
export interface IPCChannels {
  // 窗口控制
  'window:minimize': () => void;
  'window:hide': () => void;
  'window:setOpacity': (opacity: number) => void;

  // 语音控制
  'voice:start': () => void;
  'voice:stop': () => void;
  'voice:result': (text: string) => void;

  // 设置管理
  'settings:get': () => Promise<Settings>;
  'settings:set': (settings: Partial<Settings>) => Promise<void>;
}
```

## 3. 组件设计模式

### 3.1 组件目录结构

每个组件都采用统一的目录结构：

```
ComponentName/
├── index.tsx                  # 组件主文件
├── ComponentName.styled.ts    # 样式文件
├── ComponentName.types.ts     # 类型定义
├── ComponentName.test.tsx     # 测试文件
├── hooks/                     # 组件专用hooks
│   └── useComponentName.ts
└── components/                # 子组件
    └── SubComponent/
```

### 3.2 组件示例

```typescript
// src/renderer/components/voice/VoiceRecorder/index.tsx
import React from 'react';
import { useVoiceRecorder } from './hooks/useVoiceRecorder';
import { VoiceRecorderProps } from './VoiceRecorder.types';
import {
  Container,
  MicrophoneButton,
  StatusIndicator,
  VolumeIndicator
} from './VoiceRecorder.styled';

export const VoiceRecorder: React.FC<VoiceRecorderProps> = ({
  onStart,
  onStop,
  onResult
}) => {
  const {
    isRecording,
    volume,
    startRecording,
    stopRecording
  } = useVoiceRecorder({ onStart, onStop, onResult });

  return (
    <Container>
      <MicrophoneButton
        onClick={isRecording ? stopRecording : startRecording}
        $isRecording={isRecording}
      >
        🎤
      </MicrophoneButton>
      <StatusIndicator $isActive={isRecording}>
        {isRecording ? '正在监听...' : '点击开始'}
      </StatusIndicator>
      <VolumeIndicator volume={volume} />
    </Container>
  );
};
```

## 4. 状态管理结构

### 4.1 Redux Store 结构

```typescript
// src/renderer/store/index.ts
import { configureStore } from '@reduxjs/toolkit';
import { authSlice } from './slices/authSlice';
import { appSlice } from './slices/appSlice';
import { voiceSlice } from './slices/voiceSlice';
import { settingsSlice } from './slices/settingsSlice';
import { authApi } from './api/authApi';
import { aiApi } from './api/aiApi';

export const store = configureStore({
  reducer: {
    auth: authSlice.reducer,
    app: appSlice.reducer,
    voice: voiceSlice.reducer,
    settings: settingsSlice.reducer,
    authApi: authApi.reducer,
    aiApi: aiApi.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware()
      .concat(authApi.middleware)
      .concat(aiApi.middleware),
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

### 4.2 Slice 示例

```typescript
// src/renderer/store/slices/voiceSlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface VoiceState {
  isRecording: boolean;
  volume: number;
  lastRecognizedText: string;
  lastAIResponse: string;
  mode: 'simple' | 'normal' | 'detailed';
}

const initialState: VoiceState = {
  isRecording: false,
  volume: 0,
  lastRecognizedText: '',
  lastAIResponse: '',
  mode: 'normal',
};

export const voiceSlice = createSlice({
  name: 'voice',
  initialState,
  reducers: {
    startRecording: (state) => {
      state.isRecording = true;
    },
    stopRecording: (state) => {
      state.isRecording = false;
      state.volume = 0;
    },
    updateVolume: (state, action: PayloadAction<number>) => {
      state.volume = action.payload;
    },
    setRecognizedText: (state, action: PayloadAction<string>) => {
      state.lastRecognizedText = action.payload;
    },
    setAIResponse: (state, action: PayloadAction<string>) => {
      state.lastAIResponse = action.payload;
    },
    setMode: (state, action: PayloadAction<VoiceState['mode']>) => {
      state.mode = action.payload;
    },
  },
});

export const {
  startRecording,
  stopRecording,
  updateVolume,
  setRecognizedText,
  setAIResponse,
  setMode,
} = voiceSlice.actions;
```

## 5. 服务层设计

### 5.1 服务基类

```typescript
// src/renderer/services/BaseService.ts
export abstract class BaseService {
  protected apiBaseUrl: string;
  protected headers: Record<string, string>;

  constructor(baseUrl: string) {
    this.apiBaseUrl = baseUrl;
    this.headers = {
      'Content-Type': 'application/json',
    };
  }

  protected async request<T>(
    endpoint: string,
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.apiBaseUrl}${endpoint}`;
    const response = await fetch(url, {
      ...options,
      headers: {
        ...this.headers,
        ...options.headers,
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    return response.json();
  }
}
```

### 5.2 具体服务实现

```typescript
// src/renderer/services/AIService.ts
import { BaseService } from './BaseService';

export class AIService extends BaseService {
  constructor() {
    super(process.env.AI_API_BASE_URL || 'https://api.zhipuai.cn');
  }

  async getResponse(
    text: string,
    mode: 'simple' | 'normal' | 'detailed'
  ): Promise<string> {
    const response = await this.request<{ content: string }>('/chat', {
      method: 'POST',
      body: JSON.stringify({
        messages: [{ role: 'user', content: text }],
        model: 'glm-4',
        mode,
      }),
    });

    return response.content;
  }
}
```

## 6. 配置文件结构

### 6.1 TypeScript 配置

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "baseUrl": "src",
    "paths": {
      "@main/*": ["main/*"],
      "@renderer/*": ["renderer/*"],
      "@shared/*": ["shared/*"],
      "@assets/*": ["../assets/*"]
    }
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "build",
    "dist"
  ]
}
```

### 6.2 Webpack 配置

```javascript
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: process.env.NODE_ENV || 'development',
  entry: {
    main: './src/main/index.ts',
    renderer: './src/renderer/index.tsx',
    preload: './src/main/preload/index.ts',
  },
  target: {
    main: 'electron-main',
    renderer: 'electron-renderer',
    preload: 'electron-preload',
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
      {
        test: /\.(png|jpe?g|gif|svg)$/,
        type: 'asset/resource',
      },
    ],
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
    alias: {
      '@main': path.resolve(__dirname, 'src/main'),
      '@renderer': path.resolve(__dirname, 'src/renderer'),
      '@shared': path.resolve(__dirname, 'src/shared'),
      '@assets': path.resolve(__dirname, 'assets'),
    },
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/renderer/index.html',
      chunks: ['renderer'],
    }),
  ],
};
```

## 7. 测试结构

### 7.1 测试目录组织

```
test/
├── unit/                              # 单元测试
│   ├── main/                          # 主进程单元测试
│   │   ├── services/
│   │   │   ├── ScreenShareDetector.test.ts
│   │   │   └── ShortcutManager.test.ts
│   │   └── window/
│   │       └── WindowManager.test.ts
│   └── renderer/                      # 渲染进程单元测试
│       ├── components/
│       │   ├── VoiceRecorder.test.tsx
│       │   └── AIResponse.test.tsx
│       ├── hooks/
│       │   └── useVoiceRecognition.test.ts
│       └── services/
│           └── AIService.test.ts
├── integration/                       # 集成测试
│   ├── ipc-communication.test.ts      # IPC通信测试
│   ├── voice-workflow.test.ts         # 语音工作流测试
│   └── settings-persistence.test.ts   # 设置持久化测试
├── e2e/                               # 端到端测试
│   ├── login-flow.test.ts             # 登录流程测试
│   ├── voice-recognition.test.ts      # 语音识别测试
│   └── screen-share-detection.test.ts # 屏幕共享检测测试
└── fixtures/                          # 测试数据
    ├── mock-audio.wav                 # 模拟音频文件
    ├── test-settings.json             # 测试设置数据
    └── mock-responses.json            # 模拟API响应
```

### 7.2 测试配置

```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  roots: ['<rootDir>/src', '<rootDir>/test'],
  testMatch: [
    '**/__tests__/**/*.+(ts|tsx|js)',
    '**/*.(test|spec).+(ts|tsx|js)',
  ],
  transform: {
    '^.+\\.(ts|tsx)$': 'ts-jest',
  },
  moduleNameMapping: {
    '^@main/(.*)$': '<rootDir>/src/main/$1',
    '^@renderer/(.*)$': '<rootDir>/src/renderer/$1',
    '^@shared/(.*)$': '<rootDir>/src/shared/$1',
    '^@assets/(.*)$': '<rootDir>/assets/$1',
  },
  setupFilesAfterEnv: ['<rootDir>/test/setup.ts'],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/*.stories.{ts,tsx}',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};
```

## 8. 构建和部署结构

### 8.1 构建脚本

```json
// package.json scripts 部分
{
  "scripts": {
    "dev": "concurrently \"npm run dev:main\" \"npm run dev:renderer\"",
    "dev:main": "webpack --config webpack.main.config.js --watch",
    "dev:renderer": "webpack serve --config webpack.renderer.config.js",
    "build": "npm run build:main && npm run build:renderer",
    "build:main": "webpack --config webpack.main.config.js --mode production",
    "build:renderer": "webpack --config webpack.renderer.config.js --mode production",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,css,md}\"",
    "electron": "electron build/main/index.js",
    "pack": "electron-builder --dir",
    "dist": "electron-builder",
    "dist:win": "electron-builder --win",
    "dist:mac": "electron-builder --mac",
    "dist:linux": "electron-builder --linux"
  }
}
```

### 8.2 Electron Builder 配置

```json
// electron-builder.json
{
  "appId": "com.company.offerHelper",
  "productName": "AI面试助手",
  "directories": {
    "output": "dist",
    "buildResources": "assets"
  },
  "files": [
    "build/**/*",
    "node_modules/**/*",
    "package.json"
  ],
  "mac": {
    "category": "public.app-category.productivity",
    "icon": "assets/icons/app-icon.icns",
    "target": [
      {
        "target": "dmg",
        "arch": ["x64", "arm64"]
      }
    ]
  },
  "win": {
    "icon": "assets/icons/app-icon.ico",
    "target": [
      {
        "target": "nsis",
        "arch": ["x64", "ia32"]
      }
    ]
  },
  "linux": {
    "icon": "assets/icons/app-icon.png",
    "target": [
      {
        "target": "AppImage",
        "arch": ["x64"]
      }
    ]
  },
  "nsis": {
    "oneClick": false,
    "allowToChangeInstallationDirectory": true
  }
}
```

## 9. 环境配置

### 9.1 开发环境配置

```bash
# .env.development
NODE_ENV=development
ELECTRON_IS_DEV=true
AI_API_BASE_URL=https://api-dev.zhipuai.cn
TENCENT_CLOUD_ASR_URL=wss://asr-dev.tencentcloudapi.com
LOG_LEVEL=debug
AUTO_UPDATE_URL=https://update-dev.example.com
```

### 9.2 生产环境配置

```bash
# .env.production
NODE_ENV=production
ELECTRON_IS_DEV=false
AI_API_BASE_URL=https://api.zhipuai.cn
TENCENT_CLOUD_ASR_URL=wss://asr.tencentcloudapi.com
LOG_LEVEL=info
AUTO_UPDATE_URL=https://update.example.com
```

## 10. 日志和监控

### 10.1 日志配置

```typescript
// src/shared/utils/logger.ts
import winston from 'winston';
import path from 'path';

const logDir = path.join(process.cwd(), 'logs');

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'offerHelper' },
  transports: [
    new winston.transports.File({
      filename: path.join(logDir, 'error.log'),
      level: 'error'
    }),
    new winston.transports.File({
      filename: path.join(logDir, 'combined.log')
    })
  ]
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}
```

### 10.2 错误监控

```typescript
// src/main/utils/errorHandler.ts
import { logger } from '@shared/utils/logger';
import { dialog } from 'electron';

export class ErrorHandler {
  static setupGlobalErrorHandling() {
    process.on('uncaughtException', (error) => {
      logger.error('Uncaught Exception:', error);
      this.showErrorDialog('应用发生未预期的错误', error.message);
    });

    process.on('unhandledRejection', (reason, promise) => {
      logger.error('Unhandled Rejection at:', promise, 'reason:', reason);
    });
  }

  static showErrorDialog(title: string, content: string) {
    dialog.showErrorBox(title, content);
  }

  static async reportError(error: Error, context?: string) {
    const errorReport = {
      message: error.message,
      stack: error.stack,
      context,
      timestamp: new Date().toISOString(),
      version: process.env.npm_package_version
    };

    logger.error('Error Report:', errorReport);

    // 可以在这里添加错误上报到远程服务的逻辑
    // await this.sendErrorToRemoteService(errorReport);
  }
}
```

## 11. 安全配置

### 11.1 内容安全策略

```html
<!-- src/renderer/index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    connect-src 'self' https://api.zhipuai.cn wss://asr.tencentcloudapi.com;
    media-src 'self';
    font-src 'self';
  ">
  <title>AI面试助手</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>
```

### 11.2 预加载脚本安全

```typescript
// src/main/preload/index.ts
import { contextBridge, ipcRenderer } from 'electron';
import { IPCChannels } from '@shared/types/ipc';

// 安全的API暴露
const electronAPI = {
  // 窗口控制
  window: {
    minimize: () => ipcRenderer.invoke('window:minimize'),
    hide: () => ipcRenderer.invoke('window:hide'),
    setOpacity: (opacity: number) => ipcRenderer.invoke('window:setOpacity', opacity),
  },

  // 语音控制
  voice: {
    start: () => ipcRenderer.invoke('voice:start'),
    stop: () => ipcRenderer.invoke('voice:stop'),
    onResult: (callback: (text: string) => void) => {
      ipcRenderer.on('voice:result', (_, text) => callback(text));
    },
  },

  // 设置管理
  settings: {
    get: () => ipcRenderer.invoke('settings:get'),
    set: (settings: any) => ipcRenderer.invoke('settings:set', settings),
  },
};

contextBridge.exposeInMainWorld('electronAPI', electronAPI);

// 类型声明
declare global {
  interface Window {
    electronAPI: typeof electronAPI;
  }
}
```

## 12. 性能优化配置

### 12.1 Webpack 优化

```javascript
// webpack.renderer.config.js
const path = require('path');
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');

module.exports = {
  // ... 其他配置
  optimization: {
    splitChunks: {
      chunks: 'all',
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
        common: {
          name: 'common',
          minChunks: 2,
          chunks: 'all',
          enforce: true,
        },
      },
    },
  },
  plugins: [
    // 生产环境下分析包大小
    process.env.ANALYZE && new BundleAnalyzerPlugin(),
  ].filter(Boolean),
};
```

### 12.2 代码分割配置

```typescript
// src/renderer/utils/lazyLoad.ts
import { lazy, ComponentType } from 'react';

export const lazyLoad = <T extends ComponentType<any>>(
  importFunc: () => Promise<{ default: T }>
) => {
  return lazy(() =>
    importFunc().catch(() => ({
      default: () => <div>加载失败，请重试</div> as any,
    }))
  );
};

// 使用示例
export const SettingsPage = lazyLoad(() => import('../pages/SettingsPage'));
export const OnboardingPage = lazyLoad(() => import('../pages/OnboardingPage'));
```

## 13. 国际化配置

### 13.1 i18n 结构

```
src/renderer/locales/
├── index.ts                    # i18n 配置
├── zh-CN/                      # 简体中文
│   ├── common.json             # 通用文本
│   ├── auth.json               # 认证相关
│   ├── voice.json              # 语音相关
│   └── settings.json           # 设置相关
├── en-US/                      # 英文
│   ├── common.json
│   ├── auth.json
│   ├── voice.json
│   └── settings.json
└── types.ts                    # 类型定义
```

### 13.2 i18n 配置

```typescript
// src/renderer/locales/index.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import zhCN from './zh-CN';
import enUS from './en-US';

i18n
  .use(initReactI18next)
  .init({
    resources: {
      'zh-CN': zhCN,
      'en-US': enUS,
    },
    lng: 'zh-CN',
    fallbackLng: 'zh-CN',
    interpolation: {
      escapeValue: false,
    },
  });

export default i18n;
```

## 14. 文档结构

### 14.1 API 文档

```markdown
# API 文档结构

docs/api/
├── README.md                   # API 文档总览
├── ipc-channels.md             # IPC 通道文档
├── main-process-api.md         # 主进程 API
├── renderer-api.md             # 渲染进程 API
├── voice-service.md            # 语音服务 API
├── ai-service.md               # AI 服务 API
└── settings-api.md             # 设置 API
```

### 14.2 开发文档

```markdown
# 开发文档结构

docs/development/
├── getting-started.md          # 快速开始
├── development-guide.md        # 开发指南
├── debugging.md                # 调试指南
├── testing.md                  # 测试指南
├── deployment.md               # 部署指南
├── troubleshooting.md          # 问题排查
└── contributing.md             # 贡献指南
```

## 15. 版本控制配置

### 15.1 Git 配置

```gitignore
# .gitignore
# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Build outputs
build/
dist/
*.tgz

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Logs
logs/
*.log

# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Electron
out/
```

### 15.2 Git Hooks

```bash
#!/bin/sh
# .husky/pre-commit
. "$(dirname "$0")/_/husky.sh"

npm run lint
npm run test
```

```bash
#!/bin/sh
# .husky/pre-push
. "$(dirname "$0")/_/husky.sh"

npm run build
npm run test:coverage
```

这个项目结构设计文档提供了完整的AI面试助手桌面端项目组织方案，包括目录结构、配置文件、开发规范等各个方面，为项目的顺利开发和维护提供了坚实的基础。
