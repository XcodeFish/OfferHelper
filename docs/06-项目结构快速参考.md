# 项目结构快速参考

## 📁 目录结构速览

```
OfferHelper-Desktop/
├── 📂 src/                    # 源代码
│   ├── 📂 main/              # 主进程 (Electron Main)
│   ├── 📂 renderer/          # 渲染进程 (React UI)
│   ├── 📂 shared/            # 共享代码
│   └── 📂 preload/           # 预加载脚本
├── 📂 resources/             # 静态资源
├── 📂 build/                 # 构建配置
├── 📂 scripts/               # 构建脚本
├── 📂 tests/                 # 测试文件
├── 📂 docs/                  # 项目文档
├── 📂 config/                # 工具配置
└── 📂 .github/               # CI/CD 配置
```

## 🎯 核心模块

### 主进程模块 (src/main/)

```
main/
├── main.ts                   # 应用入口
├── window/                   # 窗口管理
│   ├── WindowManager.ts     # 窗口管理器
│   └── WindowConfig.ts      # 窗口配置
├── privacy/                  # 隐私保护
│   ├── PrivacyProtector.ts  # 隐私保护器
│   └── ScreenDetector.ts    # 屏幕检测
├── services/                 # 主进程服务
│   ├── UpdateService.ts     # 更新服务
│   ├── ConfigService.ts     # 配置服务
│   └── DatabaseService.ts   # 数据库服务
└── security/                 # 安全模块
    ├── SecurityManager.ts   # 安全管理器
    └── ProcessProtector.ts  # 进程保护
```

### 渲染进程模块 (src/renderer/)

```
renderer/
├── App.tsx                   # 主应用组件
├── components/               # UI 组件
│   ├── common/              # 通用组件
│   ├── layout/              # 布局组件
│   ├── features/            # 功能组件
│   └── animations/          # 动画组件
├── hooks/                    # 自定义 Hooks
├── services/                 # 渲染进程服务
├── store/                    # 状态管理
└── styles/                   # 样式文件
```

### 共享模块 (src/shared/)

```
shared/
├── types/                    # 类型定义
├── constants/                # 常量定义
├── utils/                    # 共享工具
└── interfaces/               # 接口定义
```

## 🛠️ 开发命令

### 开发环境

```bash
npm run dev              # 启动开发环境
npm run dev:main         # 只启动主进程开发
npm run dev:renderer     # 只启动渲染进程开发
```

### 构建打包

```bash
npm run build            # 构建所有代码
npm run dist             # 打包所有平台
npm run dist:mac         # 打包 macOS
npm run dist:win         # 打包 Windows
npm run dist:linux       # 打包 Linux
```

### 测试相关

```bash
npm test                 # 运行所有测试
npm run test:watch       # 监听模式测试
npm run test:coverage    # 测试覆盖率
npm run test:e2e         # 端到端测试
```

### 代码质量

```bash
npm run lint             # 代码检查
npm run lint:fix         # 自动修复
npm run format           # 代码格式化
npm run type-check       # 类型检查
npm run security-check   # 安全检查
```

## 📝 命名规范

### 文件命名

- **组件文件**: `PascalCase.tsx` (如 `WindowManager.tsx`)
- **工具文件**: `camelCase.ts` (如 `userHelpers.ts`)
- **类型文件**: `camelCase.ts` (如 `windowTypes.ts`)
- **样式文件**: `kebab-case.css` (如 `main-window.css`)

### 代码命名

- **类名**: `PascalCase` (如 `WindowManager`)
- **接口名**: `IPascalCase` (如 `IWindowManager`)
- **函数名**: `camelCase` (如 `createWindow`)
- **变量名**: `camelCase` (如 `currentUser`)
- **常量名**: `SCREAMING_SNAKE_CASE` (如 `MAX_RETRY_COUNT`)

## 🔧 配置文件

### TypeScript 配置

- `tsconfig.json` - TypeScript 编译配置
- 路径别名: `@/*` → `src/*`

### 代码质量配置

- `eslint.config.js` - ESLint 规则配置
- `prettier.config.js` - Prettier 格式化配置
- `jest.config.js` - Jest 测试配置

### 构建配置

- `webpack.main.config.js` - 主进程构建配置
- `webpack.renderer.config.js` - 渲染进程构建配置
- `electron-builder.json` - 应用打包配置

## 🎨 组件结构

### React 组件模板

```tsx
import React, { useState, useEffect, useCallback } from 'react';
import type { ComponentProps } from './types';

interface Props extends ComponentProps {
  title: string;
  onClose?: () => void;
}

const Component: React.FC<Props> = ({
  title,
  onClose
}) => {
  // 1. State hooks
  const [isVisible, setIsVisible] = useState(true);

  // 2. Effect hooks
  useEffect(() => {
    // 副作用逻辑
  }, []);

  // 3. Event handlers
  const handleClose = useCallback(() => {
    onClose?.();
  }, [onClose]);

  // 4. Render helpers
  const renderContent = () => {
    return <div>Content</div>;
  };

  // 5. Main render
  return (
    <div className="component">
      {renderContent()}
    </div>
  );
};

export default Component;
```

### 类组件模板

```typescript
class ServiceClass {
  // 1. Static properties
  private static instance: ServiceClass;

  // 2. Instance properties
  private config: Config;
  private isInitialized: boolean = false;

  // 3. Constructor
  constructor(config: Config) {
    this.config = config;
  }

  // 4. Static methods
  public static getInstance(): ServiceClass {
    if (!ServiceClass.instance) {
      ServiceClass.instance = new ServiceClass(defaultConfig);
    }
    return ServiceClass.instance;
  }

  // 5. Public methods
  public initialize(): void {
    // 初始化逻辑
  }

  // 6. Private methods
  private setupEventHandlers(): void {
    // 私有方法
  }
}
```

## 🧪 测试结构

### 单元测试

```typescript
// tests/unit/ComponentName.test.ts
describe('ComponentName', () => {
  beforeEach(() => {
    // 测试前准备
  });

  afterEach(() => {
    // 测试后清理
  });

  describe('methodName', () => {
    it('should do something when condition', () => {
      // 测试逻辑
      expect(result).toBe(expected);
    });
  });
});
```

### E2E 测试

```typescript
// tests/e2e/workflow.spec.ts
test.describe('Main Workflow', () => {
  test('should complete user journey', async ({ page }) => {
    // 测试用户完整流程
  });
});
```

## 🔒 安全检查清单

### 输入验证

- ✅ 所有用户输入必须验证
- ✅ 使用白名单而非黑名单
- ✅ 限制输入长度和格式
- ✅ 防止 XSS 和注入攻击

### 数据保护

- ✅ 敏感数据加密存储
- ✅ 使用 HTTPS 通信
- ✅ 实现数据脱敏
- ✅ 定期清理临时数据

### 权限控制

- ✅ 最小权限原则
- ✅ 禁用不必要的 Node.js 集成
- ✅ 使用内容安全策略 (CSP)
- ✅ 验证所有 IPC 通信

## 📊 性能优化

### 内存管理

```typescript
// ✅ 及时清理事件监听器
useEffect(() => {
  const handler = () => {};
  EventBus.on('event', handler);

  return () => {
    EventBus.off('event', handler);
  };
}, []);

// ✅ 使用 WeakMap 避免内存泄漏
const cache = new WeakMap();
```

### 渲染优化

```typescript
// ✅ 使用 React.memo
const Component = React.memo(({ data }) => {
  return <div>{data.name}</div>;
});

// ✅ 使用 useMemo 缓存计算
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);

// ✅ 使用 useCallback 缓存函数
const handleClick = useCallback(() => {
  onClick(id);
}, [id, onClick]);
```

## 🐛 调试技巧

### 主进程调试

```bash
# 启动调试模式
npm run dev:main -- --inspect=9229

# VS Code 调试配置已包含在 .vscode/launch.json
```

### 渲染进程调试

```bash
# 开启开发者工具
Ctrl+Shift+I (Windows/Linux)
Cmd+Option+I (macOS)

# 或在代码中打开
webContents.openDevTools();
```

### 日志调试

```typescript
// 使用统一的日志系统
import { logger } from '@/shared/utils/Logger';

logger.debug('调试信息', { data });
logger.info('普通信息', { data });
logger.warn('警告信息', { data });
logger.error('错误信息', { error });
```

## 🚀 部署流程

### 本地构建

```bash
# 1. 安装依赖
npm install

# 2. 运行测试
npm test

# 3. 安全检查
npm run security-check

# 4. 构建应用
npm run build

# 5. 打包分发
npm run dist
```

### CI/CD 流程

```yaml
# GitHub Actions 自动化流程
1. 代码检查 (ESLint, Prettier)
2. 类型检查 (TypeScript)
3. 单元测试 (Jest)
4. E2E 测试 (Playwright)
5. 安全扫描 (npm audit)
6. 构建打包 (Electron Builder)
7. 代码签名 (macOS/Windows)
8. 发布分发 (GitHub Releases)
```

## 📋 开发检查清单

### 代码提交前

- [ ] 代码格式化 (`npm run format`)
- [ ] 代码检查通过 (`npm run lint`)
- [ ] 类型检查通过 (`npm run type-check`)
- [ ] 单元测试通过 (`npm test`)
- [ ] 安全检查通过 (`npm run security-check`)

### 功能开发完成

- [ ] 添加单元测试
- [ ] 添加集成测试
- [ ] 更新文档
- [ ] 代码审查通过
- [ ] E2E 测试通过

### 发布前检查

- [ ] 版本号更新
- [ ] 更新日志完善
- [ ] 构建测试通过
- [ ] 跨平台测试
- [ ] 性能测试通过

## 🔧 常见问题解决

### 构建问题

```bash
# 清理缓存重新构建
npm run clean
rm -rf node_modules
npm install
npm run build

# 检查依赖版本冲突
npm ls
npm audit
```

### 开发环境问题

```bash
# 重置开发环境
npm run clean
npm install
npm run dev

# 检查端口占用
lsof -i :3000  # macOS/Linux
netstat -ano | findstr :3000  # Windows
```

### 打包问题

```bash
# 检查 Electron Builder 配置
npm run dist -- --publish=never

# 查看详细日志
DEBUG=electron-builder npm run dist
```

## 📚 学习资源

### 官方文档

- [Electron 官方文档](https://www.electronjs.org/docs)
- [React 官方文档](https://react.dev/)
- [TypeScript 官方文档](https://www.typescriptlang.org/docs/)

### 最佳实践

- [Electron 安全指南](https://www.electronjs.org/docs/tutorial/security)
- [React 性能优化](https://react.dev/learn/render-and-commit)
- [TypeScript 最佳实践](https://typescript-eslint.io/rules/)

### 工具链

- [Webpack 配置指南](https://webpack.js.org/configuration/)
- [Jest 测试框架](https://jestjs.io/docs/getting-started)
- [Playwright E2E 测试](https://playwright.dev/docs/intro)

## 🤝 团队协作

### Git 工作流

```bash
# 创建功能分支
git checkout -b feature/new-feature

# 提交代码
git add .
git commit -m "feat: 添加新功能"

# 推送分支
git push origin feature/new-feature

# 创建 Pull Request
# 代码审查通过后合并到 develop 分支
```

### 代码审查要点

- 代码逻辑正确性
- 性能影响评估
- 安全风险检查
- 测试覆盖率
- 文档完整性

### 沟通协作

- 使用 GitHub Issues 跟踪问题
- 使用 GitHub Projects 管理任务
- 定期进行代码审查
- 保持文档更新

---

## 📞 获取帮助

如果在开发过程中遇到问题，可以通过以下方式获取帮助：

1. **查看文档**: 首先查看项目文档和相关技术文档
2. **搜索 Issues**: 在 GitHub Issues 中搜索类似问题
3. **创建 Issue**: 如果没有找到解决方案，创建新的 Issue
4. **团队讨论**: 在团队群组中讨论技术问题
5. **代码审查**: 通过 Pull Request 获取同事反馈

**记住**: 好的代码不仅要能运行，还要易于理解、维护和扩展！ 🚀
